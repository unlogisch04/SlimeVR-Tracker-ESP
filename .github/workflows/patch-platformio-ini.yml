name: Patch platformio ini after upstream sync

on:
  push:
    branches:
      - w_main

jobs:
  patch-file:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: w_main

      - name: Copy and patch platformio.ini
        run: |
          cp platformio.ini platformio-tools.ini
          sed -i 's/^custom_slime_board =/;custom_slime_board =/g' platformio-tools.ini

      - name: Commit & Push changes (if any)
        run: |
          git add platformio-tools.ini
          if ! git diff --cached --exit-code; then
            git commit -m "Automated: Update platformio-tools.ini after upstream sync [CI skip]"
            git push origin w_main
          else
            echo "No changes to commit."
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
